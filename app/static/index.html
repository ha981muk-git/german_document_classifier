<!DOCTYPE html>
<html>
<head>
    <title>AI Document Classifier</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./static/style.css">

</head>
<body>

<h2>AI Document Classifier Powered by BERT</h2>

<div class="box">
    <h3>Select Model</h3>
    <select id="modelSelect"></select>
</div>

<div class="box">
    <h3>Enter Text</h3>
    <textarea id="textInput" rows="4" placeholder="Type or paste document text here‚Ä¶"></textarea>
</div>

<div class="box">
    <h3>Upload Document</h3>
    <input type="file" id="fileInput"
       accept="application/pdf,
               application/vnd.openxmlformats-officedocument.wordprocessingml.document,
               .doc,
               .txt,
               .json,
               .csv,
               image/*" />

    <small>Supported formats: PDF, Images, Text files, DOCX</small>
</div>




<button id="submitBtn" onclick="predict()">üöÄ Submit for Prediction</button>
<button id="clearBtn" onclick="clearForm()">Clear</button>

<div id="status"></div>

<!-- Result Box -->
<div id="resultBox" style="display:none;"></div>



<script>
    let API_BASE;

    // Check if running on localhost or 127.0.0.1
    if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
        // Development setting (FastAPI default port)
        API_BASE = "http://127.0.0.1:8080"; 
    } else if (window.location.hostname === "0.0.0.0") {
        // Docker setting 
        API_BASE = "http://0.0.0.0:8080";
    } else {
        // Default to current origin
        API_BASE = window.location.origin;
    }

    console.log("Current API BASE: ", API_BASE);

window.onload = loadModels;

async function loadModels() {
    const res = await fetch(`${API_BASE}/models`);
    const data = await res.json();

    const select = document.getElementById("modelSelect");
    select.innerHTML = "";

    data.available_models.forEach(model => {
        const opt = document.createElement("option");
        opt.value = model;
        opt.textContent = model;
        if (model === data.default_model) opt.selected = true;
        select.appendChild(opt);
    });
}

function showStatus(msg, type) {
    const st = document.getElementById("status");
    st.style.display = "block";
    st.textContent = msg;
    st.className = type === "error" ? "error" : "success";
}

function clearForm() {
    document.getElementById("textInput").value = "";
    document.getElementById("fileInput").value = "";
    document.getElementById("resultBox").style.display = "none";
    document.getElementById("status").style.display = "none";
}

async function predict() {
    const file = document.getElementById("fileInput").files[0];
    const text = document.getElementById("textInput").value.trim();
    const btn = document.getElementById("submitBtn");
    const model = document.getElementById("modelSelect").value;
 


    if (!file && !text) {
        showStatus("‚ö†Ô∏è Please provide text or upload a PDF.", "error");
        return;
    }

    const formData = new FormData();
    if (file) formData.append("file", file);
    if (text) formData.append("text", text);
    if (model) formData.append("model_name", model);

    btn.disabled = true;
    btn.textContent = "‚è≥ Processing‚Ä¶";
    showStatus("‚è≥ Classifying‚Ä¶", "success");

    try {
        const res = await fetch(`${API_BASE}/predict`, { method: "POST", body: formData });
        if (!res.ok) throw new Error("Server error: " + res.status);

        const data = await res.json();
        btn.textContent = "üöÄ Submit for Prediction";
        btn.disabled = false;

        if (data.error) {
            showStatus("‚ùå " + data.error, "error");
            return;
        }

        showStatus("‚úÖ Classification complete!", "success");

        const box = document.getElementById("resultBox");
        box.style.display = "block";

        box.innerHTML = `
            <div class="label-title">Classified as: <span>${data.result.label.toUpperCase()}</span></div>

            <div class="confidence-bar-container">
                <div class="confidence-bar" style="width: ${data.result.confidence * 100}%;">
                    ${(data.result.confidence * 100).toFixed(1)}% Confidence
                </div>
            </div>

            <div class="details">
                <strong>Details:</strong><br>
                Mode: ${data.mode}<br>
                Filename: ${data.filename || 'N/A'}<br>
                Label: ${data.result.label}<br>
                Confidence: ${data.result.confidence.toFixed(4)}<br>
                Label ID: ${data.result.label_id}
            </div>

            <br>
            <strong>Full JSON Response:</strong>
            <pre>${JSON.stringify(data, null, 2)}</pre>
        `;

    } catch (err) {
        btn.textContent = "üöÄ Submit for Prediction";
        btn.disabled = false;
        showStatus("‚ùå Error: " + err.message, "error");
    }
}
</script>

</body>
</html>
